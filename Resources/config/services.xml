<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="guzzle.http_client.class">GuzzleHttp\Client</parameter>
		<parameter key="guzzle.middleware.class">GuzzleHttp\Middleware</parameter>
		<parameter key="guzzle.formatter.class">GuzzleHttp\MessageFormatter</parameter>

        <parameter key="guzzle_bundle.plugin.header.class">EightPoints\Bundle\GuzzleBundle\EventListener\HeaderSubscriber</parameter>
        <parameter key="guzzle_bundle.plugin.wsse.class">EightPoints\Guzzle\Plugin\WsseAuthPlugin</parameter>
        <parameter key="guzzle_bundle.data_collector.class">EightPoints\Bundle\GuzzleBundle\DataCollector\HttpDataCollector</parameter>
        <parameter key="guzzle_bundle.logger.class">EightPoints\Bundle\GuzzleBundle\Log\Logger</parameter>
		<parameter key="guzzle_bundle.middleware.class">EightPoints\Bundle\GuzzleBundle\Handler\Middleware</parameter>


        <parameter key="guzzle.plugin.header.headers" type="collection" />
        <parameter key="guzzle.plugin.wsse.username" />
        <parameter key="guzzle.plugin.wsse.password" />
    </parameters>

    <services>
		<!-- Guzzle Client -->
        <service id="guzzle.client" class="%guzzle.http_client.class%">
            <argument type="collection">
                <argument key="base_uri" type="string" id="guzzle.base_url">%guzzle.base_url%</argument>
                <argument key="handler" type="service" id="guzzle.handler" />
            </argument>
        </service>

		<!-- Formatter -->
		<service id="guzzle.formatter" class="%guzzle.formatter.class%" />

		<!-- Middleware / Events -->
		<service id="guzzle_bundle.middleware" class="%guzzle_bundle.middleware.class%">
            <argument type="service" id="guzzle_bundle.logger" />
			<argument type="service" id="guzzle.formatter" />
        </service>

		<!-- Handler -->
		<service id="guzzle.handler" class="GuzzleHttp\HandlerStack">
			<factory class="GuzzleHttp\HandlerStack" method="create" />
            <call method="push">
                <argument type="expression">service('guzzle_bundle.middleware').log()</argument>
            </call>
        </service>

        <!-- HTTP Header Plugin -->
        <service id="guzzle_bundle.plugin.header" class="%guzzle_bundle.plugin.header.class%">
            <argument id="guzzle.plugin.header.headers">%guzzle.plugin.header.headers%</argument>
        </service>

        <!-- WSSE Plugin -->
        <service id="guzzle_bundle.plugin.wsse" class="%guzzle_bundle.plugin.wsse.class%">
            <argument type="string" id="guzzle.plugin.wsse.username">%guzzle.plugin.wsse.username%</argument>
            <argument type="string" id="guzzle.plugin.wsse.password">%guzzle.plugin.wsse.password%</argument>
        </service>

        <!-- Logger -->
        <service id="guzzle_bundle.logger" class="%guzzle_bundle.logger.class%"></service>

		<!-- Data Collector -->
        <service id="guzzle_bundle.data_collector" class="%guzzle_bundle.data_collector.class%" public="false">
            <tag name="data_collector" template="GuzzleBundle::debug" id="guzzle" />
            <argument type="service" id="guzzle_bundle.logger" />
        </service>
    </services>
</container>
